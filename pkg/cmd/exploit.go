package cmd

import (
	"github.com/abiosoft/ishell"
	"github.com/seaung/gagako/internal/exploit"
	"github.com/seaung/gagako/pkg/utils"
)

var exploitCmd = &ishell.Cmd{
	Name:     "exploit",
	Help:     "漏洞利用",
	LongHelp: "漏洞利用命令模块，内置了常见漏洞利用",
	Func: func(c *ishell.Context) {
		c.ShowPrompt(false)
		defer c.ShowPrompt(true)

		var port string

		target := c.ReadLine()

		isType := c.MultiChoice([]string{
			"CVE-2018-14847",
			"PHPStudy-Door",
		}, "请选择一个利用类别")

		switch isType {
		case 0:
			c.Println("请输入一个端口")
			port = c.ReadLine()
		case 1:
			c.Println("请输入一个命令")
			port = c.ReadLine()
		}

		port = c.ReadLine()

		runExploit(target, port, isType)

	},
}

func init() {
	rootCmd.AddCmd(exploitCmd)
}

func runExploit(target, port string, isType int) {
	switch isType {
	default:
		utils.New().Warnning("未知选项!")
	case 0:
		exploit.ExploitCVE201814847(target, port)
	case 1:
		exploit.ExploitPHPStudyDoor(target, port)
	}
}
